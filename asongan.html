<!DOCTYPE html>
<html lang="id">
<head>
  <!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>


  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daftar Harga Asongan & ATK</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <h1>Daftar Harga Barang Asongan & ATK</h1>
  <a href="index.html" class="btn-back">⬅ Kembali ke Menu Utama</a>

  <form id="formBarang">
    <input type="text" id="namaBarang" placeholder="Nama Barang" required>
    <input type="text" id="merek" placeholder="Merek (opsional)">
    <input type="number" id="hargaBeli" placeholder="Harga Beli (Rp)" required>
    <input type="number" id="jumlahIsi" placeholder="Jumlah Isi" required>
    <input type="number" id="hargaJual" placeholder="Harga Jual (Rp)">
    <button type="submit" class="action">Tambah Barang</button>
  </form>

  <table id="tabelBarang">
    <tr>
      <th>No</th>
      <th>Nama Barang</th>
      <th>Merek</th>
      <th>Harga Beli (Rp)</th>
      <th>Jumlah Isi</th>
      <th>Modal / pcs (Rp)</th>
      <th>Harga Jual (Rp)</th>
      <th>Keuntungan / pcs (Rp)</th>
      <th>Aksi</th>
    </tr>
  </table>

  <script type="module">
  // === Firebase Setup ===
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

   const firebaseConfig = {
      apiKey: "AIzaSyDGpOORQ9Sml8xIiGcWih7GiZ-tL8W3uNQ",
      authDomain: "hudasa-shop.firebaseapp.com",
      databaseURL: "https://hudasa-shop-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "hudasa-shop",
      storageBucket: "hudasa-shop.appspot.com",
      messagingSenderId: "715669081861",
      appId: "1:715669081861:web:5d947077b9991b392bb16c",
      measurementId: "G-MNF31EMG9Y"
    };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // === Form dan Tabel ===
  const form = document.getElementById('formBarang');
  const tabel = document.getElementById('tabelBarang');
  let editKey = null;

  form.addEventListener('submit', (e) => {
    e.preventDefault();

    const nama = document.getElementById('namaBarang').value.trim();
    const merek = document.getElementById('merek').value.trim() || "-";
    const hargaBeli = parseFloat(document.getElementById('hargaBeli').value);
    const jumlah = parseFloat(document.getElementById('jumlahIsi').value);
    const hargaJual = parseFloat(document.getElementById('hargaJual').value) || 0;

    const modal = hargaBeli / jumlah;
    const untung = hargaJual ? (hargaJual - modal) : 0;

    const data = { nama, merek, hargaBeli, jumlah, modal, hargaJual, untung };

    if (editKey) {
      update(ref(db, 'barang/' + editKey), data);
      editKey = null;
    } else {
      push(ref(db, 'barang'), data);
    }

    form.reset();
  });

  // === Menampilkan Data Realtime ===
  onValue(ref(db, 'barang'), (snapshot) => {
    const data = snapshot.val();
    tabel.innerHTML = `
      <tr>
        <th>No</th>
        <th>Nama Barang</th>
        <th>Merek</th>
        <th>Harga Beli (Rp)</th>
        <th>Jumlah Isi</th>
        <th>Modal / pcs (Rp)</th>
        <th>Harga Jual (Rp)</th>
        <th>Keuntungan / pcs (Rp)</th>
        <th>Aksi</th>
      </tr>
    `;
    if (data) {
      const arr = Object.entries(data).sort((a, b) => a[1].nama.localeCompare(b[1].nama));
      arr.forEach(([key, b], i) => {
        const row = tabel.insertRow();
        row.innerHTML = `
          <td>${i + 1}</td>
          <td style="background-color: #c7c6c1; font-size:20px; text-transform:uppercase;">${b.nama}</td>
          <td style="background-color: #d6cfc7; font-size:20px;">${b.merek}</td>
          <td>${b.hargaBeli.toLocaleString()}</td>
          <td>${b.jumlah}</td>
          <td>${b.modal.toLocaleString()}</td>
          <td style="background-color: #bebd88; font-size:35px;"><b>${b.hargaJual.toLocaleString()}</b></td>
          <td>${b.untung.toLocaleString()}</td>
          <td>
            <button class="action" onclick="editBarang('${key}')">Edit</button>
            <button class="delete" onclick="hapusBarang('${key}')">Hapus</button>
          </td>
        `;
      });
    }
  });

  // === Fungsi Edit & Hapus ===
  window.editBarang = function (key) {
    onValue(ref(db, 'barang/' + key), (snapshot) => {
      const b = snapshot.val();
      document.getElementById('namaBarang').value = b.nama;
      document.getElementById('merek').value = b.merek !== "-" ? b.merek : "";
      document.getElementById('hargaBeli').value = b.hargaBeli;
      document.getElementById('jumlahIsi').value = b.jumlah;
      document.getElementById('hargaJual').value = b.hargaJual;
      editKey = key;
    }, { onlyOnce: true });
  };

  window.hapusBarang = function (key) {
    if (confirm("Yakin ingin menghapus barang ini?")) {
      remove(ref(db, 'barang/' + key));
    }
  };
</script>

</body>

</html>


